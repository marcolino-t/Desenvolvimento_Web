<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Cadastro de Sorvetes</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" 
rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>
	<h1 class="text-center my-4">Thiagão do Picolé</h1>
	<div class="container">
		<button type="button" class="btn btn-primary mb-3" onclick="novo()">Novo Sorvete</button>
		<div id="resposta"></div>
	</div>
	
	<!-- Modal Formulário -->
	<div class="modal" id="formulario" tabindex="-1">
	  <div class="modal-dialog">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h5 class="modal-title">Cadastro de Sorvete</h5>
	        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	      </div>
	      <div class="modal-body">
			<div class="input-group mb-3">
			  <span class="input-group-text">Sabor</span>
			  <input id="sabor" type="text" class="form-control" placeholder="Sabor do Sorvete">
			</div>
			<div class="input-group mb-3">
			  <span class="input-group-text">Tamanho</span>
			  <input id="tamanho" type="text" class="form-control" placeholder="Tamanho do Sorvete">
			</div>
			<div class="input-group mb-3">
			  <span class="input-group-text">Cobertura</span>
			  <input id="cobertura" type="text" class="form-control" placeholder="Cobertura">
			</div>
			<div class="input-group mb-3">
			  <span class="input-group-text">Marca</span>
			  <input id="marca" type="text" class="form-control" placeholder="Marca">
			</div>
			<div class="input-group mb-3">
			  <span class="input-group-text">Formato</span>
			  <input id="formato" type="text" class="form-control" placeholder="Formato">
			</div>
			<div class="input-group mb-3">
			  <span class="input-group-text">Calorias</span>
			  <input id="calorias" type="text" class="form-control" placeholder="Calorias">
			</div>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
	        <button type="button" class="btn btn-primary" onclick="salvar()">Salvar</button>
	      </div>
	    </div>
	  </div>
	</div>
	
	<!-- Modal Exclusão -->
	<div class="modal" id="excluir" tabindex="-1">
	  <div class="modal-dialog">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h5 class="modal-title">Excluir Sorvete</h5>
	        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	      </div>
	      <div class="modal-body">
	        Confirmar a exclusão do registro?
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Não</button>
	        <button type="button" class="btn btn-danger" onclick="excluirsim()">Sim</button>
	      </div>
	    </div>
	  </div>
	</div>
	
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" 
		integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
	<script>
		const modal = new bootstrap.Modal('#formulario');
		const modalexcluir = new bootstrap.Modal('#excluir');
		let idatual = 0;
		
		listar();

		function listar() {
			document.getElementById("resposta").innerHTML = "Carregando...";
			
			fetch("../sorveteAPI")
				.then(resp => resp.json())
				.then(dados => {
					let tabela = `<table class='table table-hover'>
									<thead>
										<tr>
											<th>ID</th>
											<th>Sabor</th>
											<th>Tamanho</th>
											<th>Cobertura</th>
											<th>Marca</th>
											<th>Formato</th>
											<th>Calorias</th>
											<th>Ações</th>
										</tr>
									</thead>
									<tbody>`;
					for (let sorvete of dados) {
						tabela += `<tr>
										<td>${sorvete.idsorvete}</td>
										<td>${sorvete.sabor}</td>
										<td>${sorvete.tamanho}</td>
										<td>${sorvete.cobertura}</td>
										<td>${sorvete.marca}</td>
										<td>${sorvete.formato}</td>
										<td>${sorvete.calorias}</td>
										<td>
											<a href="#" onclick="alterar(${sorvete.idsorvete})">
												<img src="img/edit.svg" alt="Editar" style="width:20px; height:20px;">
											</a>
											<a href="#" onclick="excluir(${sorvete.idsorvete})">
												<img src="img/delete.svg" alt="Excluir" style="width:20px; height:20px;">
											</a>
										</td>
									</tr>`;
					}
					tabela += "</tbody></table>";
					document.getElementById("resposta").innerHTML = tabela;
				});
		}

		function novo() {
			idatual = -1;
			document.getElementById("sabor").value = "";
			document.getElementById("tamanho").value = "";
			document.getElementById("cobertura").value = "";
			document.getElementById("marca").value = "";
			document.getElementById("formato").value = "";
			document.getElementById("calorias").value = "";
			modal.show();
		}

		function alterar(idsorvete) {
			idatual = idsorvete;
			fetch(`../sorveteAPI/${idsorvete}`)
				.then(resp => resp.json())
				.then(sorvete => {
					document.getElementById("sabor").value = sorvete.sabor;
					document.getElementById("tamanho").value = sorvete.tamanho;
					document.getElementById("cobertura").value = sorvete.cobertura;
					document.getElementById("marca").value = sorvete.marca;
					document.getElementById("formato").value = sorvete.formato;
					document.getElementById("calorias").value = sorvete.calorias;
					modal.show();
				});
		}

		function excluir(idsorvete) {
			idatual = idsorvete;
			modalexcluir.show();
		}

		function excluirsim() {
			fetch(`../sorveteAPI/${idatual}`, { method: "DELETE" })
				.then(resp => resp.json())
				.then(resposta => {
					alert(resposta.mensagem);
					modalexcluir.hide();
					listar();
				});
		}

		function salvar() {
			let sorvete = {
				sabor: document.getElementById("sabor").value,
				tamanho: document.getElementById("tamanho").value,
				cobertura: document.getElementById("cobertura").value,
				marca: document.getElementById("marca").value,
				formato: document.getElementById("formato").value,
				calorias: document.getElementById("calorias").value
			};
			
			let metodo = idatual > 0 ? "PUT" : "POST";
			let endpoint = idatual > 0 ? `../sorveteAPI/${idatual}` : "../sorveteAPI";
			
			fetch(endpoint, {
				method: metodo,
				headers: { "Content-Type": "application/json" },
				body: JSON.stringify(sorvete)
			})
			.then(resp => resp.json())
			.then(resposta => {
				alert(resposta.mensagem);
				modal.hide();
				listar();
			});
		}
	</script>
</body>
</html>
